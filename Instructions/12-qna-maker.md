---
lab:
    title: 'QnA ソリューションの作成'
    module: 'モジュール 6 - QnA ソリューションを構築する'
---

# QnA ソリューションの作成

最も一般的な会話シナリオの 1 つは、よくある質問 (FAQ) のナレッジ ベースを通じてサポートを提供することです。多くの組織は、FAQ をドキュメントまたは Web ページとして公開しています。これは、質問と回答のペアの小さなセットに適していますが、大きなドキュメントは検索が難しく、時間がかかる場合があります。

QnA Maker は、自然言語入力を使用してクエリできる質問と回答のペアのナレッジベースを作成できる Cognitive Services であり、ボットがユーザーから送信された質問への回答を検索するために使用できるリソースとして最も一般的に使用されます。

このラボでは、Text Analytics の機能である Managed QnAMaker を使用します。 

## Language リソースを作成する 

Managed QnA Maker を使用してナレッジ ベースを作成してホストするには、Azure サブスクリプションに Language リソースが必要です。

1. `https://portal.azure.com` で Azure portal を開き、Azure サブスクリプションに関連付けられている Microsoft アカウントを使用してサインインします。
2. **「リソースの作成」** ボタンを選択し、*Language* を検索して、**Language service** リソースを作成します。 
3. **「Custom question answering」** ブロックで **「Select」** をクリックします。次に、**「Continue」** をクリックして、リソースを作成します。次の設定を入力する必要があります。
    
    - **サブスクリプション**: *お使いの Azure サブスクリプション*
    - **リソース グループ**: *リソース グループを選択または作成します (制限付きサブスクリプションを使用している場合は、新しいリソース グループを作成する権限がない可能性があります - 提供されているものを使用してください)*
    - **リージョン**: *使用可能な場所を選択します*
    - **名前**: *一意の名前を入力します*
    - **価格レベル**: 標準 S
    - **Azure 検索の場所**\*： *Language リソースと同じグローバル リージョン内の場所を選択します*。
    - **Azure Search の価格レベル**：無料 (F) (*このレベルが利用できない場合は、「基本 (B)」 を選択します*)
    - **法律条項**：_同意_ 
    - **責任ある AI に関する通知**：_同意_
    
    カスタム質問応答は、Azure Search を使用して、質問と回答のナレッジ ベースにインデックスを付けてクエリを実行します。

4. デプロイが完了するのを待ってから、デプロイの詳細を表示します。

## ナレッジ ベースの作成

Language リソースにナレッジ ベースを作成するには、QnA Maker ポータルを使用できます。この場合、[Microsoft Learn](https://docs.microsoft.com/learn) に関する質問と回答を含むナレッジ ベースを作成します。

1. 新しいブラウザー タブで、`https://qnamaker.ai` で QnA Maker ポータルに移動し、Azure サブスクリプションに関連付けられている Microsoft アカウントを使用してサインインします。
2. ポータルの上部で、**「ナレッジ ベースの作成」** を選択します。
3. QnA Maker 用のリソースは既に作成されているため、手順 1 をスキップできます。**手順 2** のセクションで、次の設定を選択します。
    - **Microsoft Azure ディレクトリ ID**: サブスクリプションを含む Azure ディレクトリ。
    - **Azure サブスクリプション名**: Azure サブスクリプション。
    - **Azure QnA サービス**: 以前に作成した Text Analytics リソース。
    - **言語**: 英語 (*既定は、このオプションは最初に作成したナレッジ ベースでのみ使用できます*)。
4. **手順 3** のセクションで、ナレッジ ベースの名前として、**Learn FAQ** と入力します。

    ナレッジ ベースは最初から作成できますが、既存の FAQ ページまたはドキュメントから質問と回答をインポートすることから始めるのが一般的です。

5. **ステップ 4** セクション:
    - **「URL」** ボックスに、`https://docs.microsoft.com/ja-jp/learn/support/faq` と入力し、**「URL の追加」** をクリックします。
    - **「Chit-chat」** セクションで、**「フレンドリー」** を選択します。
6. **手順 5** のセクションで、**「KB の作成」** を選択し、ナレッジ ベースが作成されるのを待ちます。

## ナレッジベースの変更

ナレッジ ベースには、Microsoft Learn FAQ の質問と回答のペアが入力されており、会話型 *chit-chat* の質問と回答のペアが追加されています。質問と回答のペアを追加することで、ナレッジ ベースを拡張できます。

1. ナレッジ ベースで、**「QnA ペアの追加」** を選択します。
2. **「質問」** ボックスに`What is Microsoft certification?`と入力します。
3. **「代替フレージングの追加」** を選択し、「How can I demonstrate my Microsoft technology skills?」と入力します。
4. **「回答」** ボックスに「The Microsoft Certified Professional program enables you to validate and prove your skills with Microsoft technologies.」と入力します。

    場合によっては、ユーザーが回答をフォローアップして、*複数ターン*会話を作成できるようにすることが理にかなっています。ユーザーは、質問を繰り返し絞り込んで、必要な回答者にたどり着きます。

5. 認定の質問に入力した回答の下で、**「フォローアップ プロンプトの追加」** を選択します。
6. **「フォローアップ プロンプト」** ダイアログ ボックスで、次の設定を入力します。
    - **表示テキスト**: `Learn more about certification.`
    - **QnAへのリンク**\*: `You can learn more about certification on the [Microsoft certification page](https://docs.microsoft.com/learn/certifications/).`
    - **コンテキストのみ**: オンにします。*このオプションにより、元の認定質問からのフォローアップ質問のコンテキストでのみ回答が返されるようになります。*

    \***「QnA へのリンク」** ボックスに入力すると、ナレッジ ベース内の既存の回答が検索されます。一致するものが見つからない場合、デフォルトで新しい QnA ペアが作成されます。ここに入力するテキストはマークダウン形式であることに注意してください。

## ナレッジ ベースのトレーニングとテスト

ナレッジベースができたので、QnA Maker ポータルでテストできます。

1. ページの右上にある **「保存してトレーニング」** をクリックして、ナレッジベースをトレーニングします。
2. トレーニングが完了したら、**「テスト」** をクリックして、「テスト」 ペインを開きます。
3. 「テスト」 ペインの上部にある *「短い回答を表示」* というボックスの*選択を解除*します。次に、「テスト」 ペインの下部に、「*Hello*」というメッセージを入力します。適切な応答が返される必要があります。
4. テストペインの下部に、「*What is Microsoft Learn?*」というメッセージを入力します。FAQ からの適切な応答が返される必要があります。
5. 「*That makes me happy!*」というメッセージを入力します。適切な chit-chat 応答が返される必要があります。
6. 「*Tell me about certification*」というメッセージを入力します。作成した回答は、フォローアップ プロンプト ボタンとともに返されます。
7. **「認定のフォローアップの詳細」** ボタンを選択します。認定ページへのリンクを含むフォローアップ回答を返送する必要があります。
8. ナレッジベースのテストが終了したら、**「テスト」** をクリックして、「テスト」 ペインを閉じます。

## ナレッジ ベースの公開

ナレッジ ベースは、クライアント アプリケーションが質問に回答するために使用できるバックエンド サービスを提供します。これで、ナレッジ ベースを公開し、クライアントからその REST インターフェイスにアクセスする準備が整いました。

1. QnA Makerページの上部で、**「公開」** をクリックします。次に、**「FAQの学習」** ページで、**「公開」** をクリックします。
2. 公開が完了したら、ナレッジベースの REST エンドポイントを使用するために提供されているサンプル コードを表示します。*Postman* の例と *Curl* の例があります。
3. **「Curl」** タブを表示し、サンプル コードをコピーします。
4. Visual Studio Code を起動し、「ターミナル」 ペインを開きます。
5. コピーしたコードをターミナルに貼り付け、編集して **&lt;your question&gt;** を 「**What is a learning path?**」 に置き換えます。
6. コマンドを入力し、ナレッジベースから返される JSON 応答を表示します。

## ナレッジ ベース用のボットを作成する

最も一般的には、ナレッジ ベースから回答を取得するために使用されるクライアント アプリケーションはボットです。

1. 公開確認とサンプル Curl コードを含むページで、**「ボットの作成」** を選択します。これにより、新しいブラウザー タブで Azure portal が開き、Azure サブスクリプションで Web アプリ ボットを作成できます。
2. Azure portal で、次の設定を使用して Web アプリ ボットを作成します (これらのほとんどは事前に入力されています)。

    *一部の値が欠落している場合は、ブラウザーを更新します。*  

  - **ボット ハンドル**: *ボットの一意の名前*
  - **サブスクリプション**: *お使いの Azure サブスクリプション*
  - **リソース グループ**: *QnA Maker リソースを含むリソース グループ*
  - **場所**: *Text Analytics サービスと同じ場所*。
  - **価格レベル**: F0
  - **アプリ名**: *azurewebsites.net* が自動的に追加された**ボット ハンドル**と同じ
  - **SDK 言語**: *C# または Node.js のいずれかを選択*
  - **QnA 認証キー**: *これは、QnA ナレッジ ベースのの認証キーに自動的に設定されます。*
  - **アプリ サービス プラン/場所**: *これは、適切なプランと場所が存在する場合は、自動的に設定される場合があります。そうでない場合は、新しいプランを作成します*
  - **Application Insights**: オフ
  - **Microsoft アプリ ID とパスワード**: アプリ ID とパスワードを自動作成します。
3. ボットが作成されるのを待ちます (ベルのように見える右上の通知アイコンが、待つ間アニメーション化されます)。次に、デプロイが完了したという通知で、**「リソースに移動」** をクリックします (または、ホーム ページで **「リソース グループ」** をクリックし、Web アプリ ボットを作成したリソース グループを開いてクリックします)。
4. ボットのブレードで、**「Test in Web Chat」** ページを表示し、ボットが「**Hello and welcome!**」というメッセージを表示するまで待ちます。(初期化には数秒かかる場合があります)。
5. テスト チャット インターフェイスを使用して、ボットがナレッジ ベースからの質問に期待どおりに回答することを確認します。たとえば、「*What is Microsoft certification?*」を送信してみてください。

## 詳細

QnA Maker の詳細については、[QnA Makerのドキュメント](https://docs.microsoft.com/azure/cognitive-services/qnamaker/)を参照してください。
